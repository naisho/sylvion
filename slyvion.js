// http://www.zmangames.com/uploads/4/7/1/7/47170931/en-sylvion-rules-v3.pdf

// Import this file later
var intro = '{"_title":"Planting a Seed","_description":"This first step will allow you to start playing the game quickly, without having to read the rule book in its entirety. Playing this mode will introduce you to Sylvionâ€™s core concepts.","game":{"player":{"Sylvan":{"deck":[{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":0,"strength":1,"shortName":"F1"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":0,"strength":1,"shortName":"F1"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":1,"strength":2,"shortName":"F2"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":1,"strength":2,"shortName":"F2"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":2,"strength":3,"shortName":"F3"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":2,"strength":3,"shortName":"F3"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":3,"strength":4,"shortName":"F4"},{"name":"Fountain","faction":"Sylvan","type":"fountain","cost":3,"strength":4,"shortName":"F4"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":0,"strength":0,"vitality":1,"shortName":"T1"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":0,"strength":0,"vitality":1,"shortName":"T1"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":1,"strength":0,"vitality":2,"shortName":"T2"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":1,"strength":0,"vitality":2,"shortName":"T2"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":2,"strength":0,"vitality":3,"shortName":"T3"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":2,"strength":0,"vitality":3,"shortName":"T3"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":3,"strength":0,"vitality":4,"shortName":"T4"},{"name":"Tree","faction":"Sylvan","type":"tree","cost":3,"strength":0,"vitality":4,"shortName":"T4"},{"name":"Whale","faction":"Sylvan","type":"animal","cost":0,"effect":"move","target":"elemental","shortName":"W "},{"name":"Whale","faction":"Sylvan","type":"animal","cost":0,"effect":"move","target":"elemental","shortName":"W "},{"name":"Elephant","faction":"Sylvan","type":"animal","cost":1,"effect":"destroy","target":"elemental","shortName":"E "},{"name":"Elephant","faction":"Sylvan","type":"animal","cost":1,"effect":"destroy","target":"elemental","shortName":"E "},{"name":"Hedgehogs","faction":"Sylvan","type":"animal","cost":0,"effect":"counter","shortName":"HH"},{"name":"Hedgehogs","faction":"Sylvan","type":"animal","cost":0,"effect":"counter","shortName":"HH"},{"name":"Owl","faction":"Sylvan","type":"animal","cost":1,"effect":"draw","value":3,"target":"player","shortName":"Ow"},{"name":"Owl","faction":"Sylvan","type":"animal","cost":1,"effect":"draw","value":3,"target":"player","shortName":"Ow"}]},"Ravage":{"deck":[{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":0,"shortName":"E0"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":1,"shortName":"E1"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":2,"shortName":"E2"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Elemental","faction":"Ravage","type":"elemental","cost":0,"strength":3,"shortName":"E3"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Blaze","faction":"Ravage","type":"support","cost":0,"effect":"pump","priority":"C","shortName":"Bz"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"},{"name":"Simoon","faction":"Ravage","type":"support","cost":0,"effect":"move","value":1,"priority":"D","shortName":"Sm"}]}}}}';

// GAME LEVEL OBJECTS
// need to create card object
// function card(properties)
// this.properties = values

var game = {    
    board: [],
    player: {
        Player1: {
            hand: []
           },
        Player2: {
            hand: []
        },
        Sylvan: {
            deck: [],
            discard: [],
        },
        Ravage: {
            deck: [],
            discard: [],
            stacks: [
                [], // stack1
                [], // stack2
                [], // stack3
                []  // stack4
            ]
        }
    },
    zone: {
        effects: [],
        RFG: [],
        waterPool: 0,
        selection: {
            card: {},
            target1: {
                target: {},
                location: []
            },
            target2: {
                target: {},
                location: []
            }
        }
    }
}; // var game

var gameBoard = game.board
var firstPlayer = game.player.Player1
var sylvanPlayer = game.player.Sylvan
var sylvanDeck = game.player.Sylvan.deck
var sylvanDiscard = game.player.Sylvan.discard
var ravagePlayer = game.player.Ravage
var ravageDeck = game.player.Ravage.deck
var ravageDiscard = game.player.Ravage.discard
var ravageStacks = game.player.Ravage.stacks
var secondPlayer = game.player.Player2
var effectsZone = game.zone.effects
var rfgZone = game.zone.RFG
var historyZone = game.zone.history
var selectedCard = game.zone.selection.card
var selectedTarget1 = game.zone.selection.target1.target
var selectedLocation1 = game.zone.selection.target1.location
var selectedTarget2 = game.zone.selection.target2.target
var selectedLocation2 = game.zone.selection.target2.location
var selectedPayment = []














// HELPER FUNCTIONS
// Fisher-Yates Shuffle
function shuffle(r){for(var f,n,o=r.length;o;)n=Math.floor(Math.random()*o--),f=r[o],r[o]=r[n],r[n]=f;return r}

// map card names of array
function cardNames(cards) {
    return cards.map(function(a) {return a.name});
}

// show current board using short names
function showBoard() {
    horizontalLine();
    for (var i = 1; i <= 6; i++) {
        var text = 'console.log("Row#",i'
        for (var j = 1; j <= 6; j++) {
            text = text + ",game.board[i][" + j + "][0].shortName"
        }
        text = text + ");"
        eval(text);
    }
}

// show Player1.hand with array index
function showHand() {
	horizontalLine();
	for (var i = 0; i < firstPlayer.hand.length; i++) {
		console.log(i,firstPlayer.hand[i].shortName,firstPlayer.hand[i].name);
	}
}

// provide spacing between output
function horizontalLine() {
    console.log("*****");
}

function horizontalLine2() {
    console.log("==========");
}

function emptyCard() {
    var newCard = {"shortName":"__"}
    // clone newCard object
    return JSON.parse(JSON.stringify(newCard))
}

// UNFINISHED FUNCTIONS
// loop through battlefield
function ForBattlefield(func) {
    for (var x = 2; x <= 5; x++) {
        for (var y = 2; y <= 5; y++) {
            eval(func);
        }
    }
}

// loop through battlefield plus ravage stacks
function ForExtendedBattlefield(func) {
    for (var x = 2; x <= 5; x++) {
        for (var y = 2; y <= 6; y++) {
            // console.log(func);
            eval(func);
        }
    }
}














// GAME FUNCTIONS
// (all individual card effects are in a different section)

// draw cards
function draw(noOfCards, target) {
    for (var i = noOfCards; i >= 1; i--) {
        game.player[target].hand.unshift(sylvanDeck.shift());
        console.log(" --> Drew card: " + game.player[target].hand[0].name);
    }
}


// set life total and update edge cards
function setLifeTotal(life) {
    // define location and order of edge cards
    if (life <= 0) {
        console.log("you lose");
        return "rip"
    } else {
        var b = game.board;
        var edge = [
                b[1][5], b[1][4], b[1][3], b[1][2], // top edge
                b[2][1], b[3][1], b[4][1], b[5][1], // left edge
                b[6][2], b[6][3], b[6][4], b[6][5]  // bot edge
                   ]

        for (var i = 0; i < life ; i++) {
            edge[i][0].shortName = "B "; // bloom
            edge[i][0].type = "edge";
        }

        for (var j = life; j < 12 ; j++) {
            edge[j][0].shortName = "D " // desolated
            edge[j][0].type = "edge";
        }
        console.log("life total set to " + life);
        return life
    }
} // setLifeTotal()

// define battlefield area
// probably dont need this
function battlefield(x, y) {
    return game.board[x+1][y+1];
}

// load game type like First Game, Beginner, Advanced, Expansion 1, etc.
function load(file) {
    // load expansion
    var expansion = JSON.parse(file);

    var sylvanExpansion = expansion.game.player.Sylvan.deck
    var ravageExpansion = expansion.game.player.Ravage.deck


    var id = 0 // unique id for each card
    // add sylvan cards from expansion into current game
    for (var i = sylvanExpansion.length - 1; i >= 0; i--) {
         sylvanExpansion[i].id = id++
         sylvanDeck.push(sylvanExpansion[i]);
    }
    console.log("loaded Sylvan deck");
    // console.log(game.player.Sylvan.deck);
    // add ravage cards from expansion into current game
    for (var i = ravageExpansion.length - 1; i >= 0; i--) {
        ravageExpansion[i].id = id++
          ravageDeck.push(ravageExpansion[i]);
    }
    console.log("loaded Ravage deck");
    // console.log(game.player.Ravage.deck);
} // load()

/*// play a card
function playCard(x,y) {
    horizontalLine();
    console.log("Resolving",game.board[x][y].name);
    resolve(game.board[x][y].effect,game.board[x][y].value);
    if (game.board[x][y].type == "support") {
        discard(x-1,y-1);
        remove(x-1,y-1);
    }
}*/

//new playcard
function playCard(card,origin,target) {
    horizontalLine();
    console.log("Resolving",card.name);
    resolve(card.effect,card.value);
    discard(card);
}




// 4. DEFENSE
/*function selectCardFromHand(index) {
    selectedCard = firstPlayer.hand[index]
    // console.log("Selected",selectedCard.name,selectedCard.shortName);
    return "Selected " + selectedCard.name + " (" + selectedCard.shortName + ")"
}*/

function deselectCard() {
    selectedCard = {}
    return "Deselected all cards"
}

/*function selectTarget1(target) {
    if (selectedCard) {
        selectedTarget1 = target
        return "Selected " + selectedTarget1.name + " (" + selectedTarget1.shortName + ")" + " as primary target"
    } else {
        return "Please select a card from hand before selecting a target"
    }
}*/

/*function selectTarget2(target) {
    if (selectedCard) {
        selectedTarget2 = target
        return "Selected " + selectedTarget2.name + " (" + selectedTarget2.shortName + ")" + " as secondary target"
    } else {
        return "Please select a card from hand before selecting a target"
    }}*/


function deselectTargets() {
    selectedTarget1 = {}
    selectedLocation1 = []
    selectedTarget2 = {}
    selectedLocation2 = []
    return "Deselected all targets"
}

/*
changed card resolution into different phases
function playCardFromHand() {
    // var card = firstPlayer.hand[n]
    // var card = firstPlayer.hand.splice(n,1)[0]
    if ((selectedCard.target == selectedTarget1.type) || !(selectedCard.target)) {
        console.log("I can play this card")
        playCard(selectedCard,selectedTarget1,selectedTarget2);
        var indexOfCard = firstPlayer.hand.map(function(i){return i.id}).indexOf(selectedCard.id)
        firstPlayer.hand.splice(indexOfCard,1);
        discard(selectedCard);
        selectedCard = emptyCard();
        showHand();
    } else {
        console.log("Can't play this card")
    }
    // playCard(card);
    // whale
    // elephant
    // hedgehogs
    // owl
}
*/

function declareCardFromHand(n) {
    selectedCard = firstPlayer.hand[n]
    console.log("Player1 declares ", selectedCard.name)
    console.log("Select effect targets")
    return
}

function selectTarget1(x,y) {
    if (selectedCard) {
        if ((typeof(x) == "string") && (y == null)) {
            selectedTarget1 = {type:"Player", target:x}
        } else {
            selectedTarget1 = gameBoard[x][y][0]
            selectedLocation1 = [x,y]
            if (selectedTarget1.shortName != "__") {
                console.log("Selected " + selectedTarget1.name + " (" + selectedTarget1.shortName + ")" + " as primary target");
            } else {
                selectedTarget1 = gameBoard[x][y]
                console.log("Selected board space " + x + "," + y + " as primary target");
            }
        }
    } else {
        return "Please declare a card from hand before selecting a target"
    }
}

function selectTarget2(x,y) {
    if (selectedCard && selectedTarget1) {
        selectedTarget2 = gameBoard[x][y][0]
        selectedLocation2 = [x,y]
        if (selectedTarget2.shortName != "__") {
            console.log("Selected " + selectedTarget2.name + " (" + selectedTarget2.shortName + ")" + " as secondary target");
        } else {
            selectedTarget2 = gameBoard[x][y]
            console.log("Selected board space " + x + "," + y + " as secondary target");
        }
    } else {
        return "Please select a primary target before selecting a secondary target"
    }
}

function selectPayment() {
    if (selectedCard) {
        return selectedPayment = [].slice.call(arguments).sort()
    } else {
        return "Please declare a card from hand before selecting payment"
    }
}

function playCardFromHand() {
    if (((selectedCard.target == selectedTarget1.type) || !(selectedCard.target)) && (selectedPayment.length == selectedCard.cost)) {
        console.log("I can play ",selectedCard.name)
        for (var i = selectedPayment.length - 1; i >= 0; i--) {
            discardFromHand(selectedPayment[i]);
        }
        playCard(selectedCard,selectedTarget1,selectedTarget2);
        var indexOfCard = firstPlayer.hand.map(function(i){return i.id}).indexOf(selectedCard.id)
        // showHand();
        // console.log("Discarding card ID ",selectedCard.id);
        firstPlayer.hand.splice(indexOfCard,1);
        discard(selectedCard);
        deselectCard();
        deselectTargets();
        selectedPayment = []
        showHand();
    } else {
        console.log("Can't play this card")
    }
}







/*
// will not implement due to complexity
// alternative: save game state every action
function undo(noOfEffects) {
    // repeat effect with destination and origin swapped
    // works for: move, simoon
    // doesn't work for: combat, elementals, blaze
    
    // reverse blaze
    // remove all current elementals from the game
    // return all elementals discarded by last blaze
    // requires: original position
}
*/

// card effects
function resolve(effect, value) {
    switch(effect) {
        case "pump":
            // for each grid cell, check if card type elemental then switch/case 1=>2, 2=>3, 3=>4, 0=>4
            for (var x = 2; x <= 5; x++) {
                for (var y = 2; y <= 6; y++) {
                    var currentCard = gameBoard[x][y][0]
                    if (currentCard.type == "elemental") {
                        // increase elemental strength
                        var newStr = [4,2,3,4,4][currentCard.strength]
                        if (currentCard.strength != newStr) {
                            var newShortName = "B" + newStr
                            var newCard = {"name":"Blazing Elemental", "faction":"Ravage", "type":"elemental", "strength":newStr, "shortName":newShortName};
                            console.log("Increasing",currentCard.shortName,"to",newStr);
                            discard(currentCard);
                            console.log("Discarding ", currentCard.name)
                            // gameBoard[x][y] = [emptyCard()]
                            Object.assign(currentCard,newCard);
                            // discard(x,y);
                        }
                    }
                }
            }
            break;

        case "move":
            // for each grid cell, check if card type elemental then move left %value spaces
            if (selectedTarget1.type == "elemental") {
                moveElemental(selectedLocation1,selectedLocation2);
            } else {
                console.log("no target..moving all elementals")
                ForExtendedBattlefield('moveElemental([x,y],[x,y-' + value + '])');
            }


/*            for (var x = 2; x <= 5; x++) {
                for (var y = 2; y <= 6; y++) {
                    var currentCard = gameBoard[x][y][0]
                    // console.log(gameBoard[x][y][0]);
                    if (currentCard.type == "elemental") {
                        moveElemental([x,y],[x,y-value]);
                    }
                }
            }*/
/*            ForExtendedBattlefield('\
                console.log("x:",x, " y:", y);\
                var currentCard = gameBoard[x][y][0];\
                if (currentCard.type == "elemental") {\
                    moveElemental([x,y],[x,y-' + value + ']);\
                }\
            ');
*/
            // console.log("move");
            showBoard();
            break;

        case "draw":
        // target player draws *value* cards
            draw(value,selectedTarget1.target);
            showHand();
            break;


        case "destroy":
        // discard target
            discard(selectedTarget1);
        // replace target with blank card
            deleteCard(selectedTarget1);
            showBoard();
            break;

/*        case "whale":
        // move elemental from origin to destination
            console.log("its a whaleeee");
            for (var x = 2; x <= 5; x++) {
                for (var y = 2; y <= 6; y++) {
                    var currentCard = gameBoard[x][y][0]
                    // console.log(gameBoard[x][y][0]);
                    if (currentCard.type == "elemental") {
                        console.log("move " + value + " spaces");
                        moveElemental([x,y],[x,y-value]);    
                    }
                }
            }
            break;*/

        case "counter": 
            console.log("Countering", selectedCard.name);
            resolve("destroy")
            break;
        
        default:
            console.log(selectedCard.name + " has no effect");
            if (selectedCard.type == "fountain" || "tree") {
                // console.log(selectedCard);
                // console.log(selectedTarget1);
                selectedTarget1.pop();
                selectedTarget1.push(selectedCard);
            }
    }
}

function useHedgehog(x,y) {
    // use Hedgehog card on the board location at x, y
    selectTarget1(x,y);
    console.log("choosing this card to remove", selectedTarget1);
    removeFromBoard(x,y);
    showBoard();
}

// move elemental card
// used in: simoon, move phase, whale
function moveElemental(from, to) {
    // if destination has a fountain/tree, call combat function
    // console.log(from);
    // console.log(to);
    var origin = gameBoard[from[0]][from[1]]
    var destination = gameBoard[to[0]][to[1]]
    // need to account for if destination index is < 1.. ?
    var currentCard = origin[0]
    // console.log(origin);
    if (currentCard.type == "elemental") {
        console.log("Moving",currentCard.shortName);
        destination.push(origin.shift()); // moved elemental is on bottom
        origin.push(emptyCard());
        if (destination[0].faction == "Sylvan") {
            combat(destination);
        } else if (destination[0].type == "edge") {
            setLifeTotal(game.player.Sylvan.lifeTotal -= origin[0].strength);
            origin.shift();
            origin.push(emptyCard());
        } else {
            destination.shift();
        }
    }
}


/*
// old discard
function discard(x, y) {
    var currentCard = battlefield(x,y);
    // clone object by converting to JSON
    game.player[currentCard.faction].discard.push(JSON.parse(JSON.stringify(currentCard)));
}
*/

// new discard
function discard(card) {
    game.player[card.faction].discard.unshift(JSON.parse(JSON.stringify(card)));
    return card
}

function discardFromHand(n) {
    console.log("Discarded",firstPlayer.hand[n]);
    discard(firstPlayer.hand[n])
    firstPlayer.hand.splice(n,1);
}

function deleteCard(card) {
    for (var attrname in card) {
        card[attrname] = "";
        //delete card.attrname;
    }

    for (var attrname in emptyCard()) {
        card[attrname] = emptyCard()[attrname]
    }
}


/*
// old remove
function remove(x,y) {
    var currentCard = battlefield(x,y);
    // console.log("Removing",currentCard)
    game.board[x+1][y+1] = {"shortName":"__"}
}
*/

function removeFromBoard(x,y) {
    var currentCard = gameBoard[x][y][0]
    console.log("Removing (",x,",",y,")",currentCard.name);
    gameBoard[x][y] = [emptyCard()]
}



function combat(a) {
    sylvanCard = a[0]
    ravageCard = a[1]
    // check to make sure combat is valid
    if (sylvanCard.faction == "Sylvan" && ravageCard.faction == "Ravage") {
        // Sylvan card is on top of Ravage card
        if (sylvanCard.strength >= ravageCard.strength) {
            console.log(sylvanCard.name,">=","Ravage",ravageCard.name);
            a.pop(); // Ravage loses
        }
        if (sylvanCard.strength <= ravageCard.strength) {
            console.log(sylvanCard.name,"<=",ravageCard.name);
            a.shift(); // sylvan loses
            draw(1,"Player1");
        }
    } else {
        horizontalLine2();
        console.log("Combat is invalid!! Help!")
        horizontalLine2();
    }
    if (a.length == 0) {
        a.push(emptyCard());
        console.log(sylvanCard.name,"==",ravageCard.name);
    }

// compare toughness and strength
// move loser to discard


// need to replace each board space with array so multiple objects can bei n the same space
}













// START NEW GAME
function newGame() {
    // Populate game.board with "__" to provide spacing
    game.board.push([]);
    for (var i = 1; i <= 6; i++) { // for col 1-6
        gameBoard.push([]); // create array for rows
        gameBoard[i].push([]); // create stack in each cell
        for (var j = 1; j <= 6; j++) {
            gameBoard[i].push([emptyCard()]); // fill each cell with emptyCard()
        }
    }
    // Below code was not used because all objects created shared the same instance in each row
    // game.board[i] = new Array(6).fill(new Object({}));
    // game.board[i] = [{"shortName":"01"},{"shortName":"02"},{"shortName":"03"},{"shortName":"_4"},{"shortName":"_5"},{"shortName":"_6"}]

    // load decks
    load(intro);
    game.player.Sylvan.lifeTotal = setLifeTotal(6); // life total should be added into expansion to allow for difficulty settings
    showBoard();

    // shuffle decks
    shuffle(sylvanDeck);
    shuffle(ravageDeck);

    // divide Ravage deck into 4 stacks
    // stacks are game.player.Ravage.stack1, stack2, etc.
    // console.log("ravageDeck:", ravageDeck.length);
    for (var stackNumber = 0; stackNumber <= 3; stackNumber++) {
        for (var cardsPerStack = ravageDeck.length/4-1; cardsPerStack >= 0; cardsPerStack--) {
            game.player.Ravage.stacks[stackNumber].push(ravageDeck[cardsPerStack+stackNumber*ravageDeck.length/4]);
            // console.log("Stack#",stackNumber,"Card#",cardsPerStack+stackNumber*ravageDeck.length/4,game.player.Ravage.stacks[stackNumber]);
        }
    }


    draw(8,"Player1");
//     console.log("Player1's Hand",cardNames(game.player.Player1.hand));
//     console.log("Sylvan Deck",cardNames(game.player.Sylvan.deck));
    
    horizontalLine2();
    console.log("Begin First Battle Phase");
} // newGame()





// BATTLE PHASE
function battle() {
    //1. reveal Ravage cards
    revealRavage();
    //1a. player has option to use cards which counter ravage : To be built


    if (firstPlayer.hand.map(function(a) {return a.effect}).includes("counter")) {
        console.log("You may counter any ravage cards.  Proceed with continueBattle() afterwards.")
    } else {
        //2. Resolve Ravage cards (i.e resolving their effects)
        resolveRavage();

        //3. Move elementals by one -- right now, already in the resolveRavage() function. might need to extract out
        //moveElemental(spaces) -- new move function which takes in number of spaces?
        moveElementals();

        //4. Draw Reinforcements (3 cards)
        drawReinforcements();
    }
}

function continueBattle() {
    //2. Resolve Ravage cards (i.e resolving their effects)
    resolveRavage();

    //3. Move elementals by one -- right now, already in the resolveRavage() function. might need to extract out
    //moveElemental(spaces) -- new move function which takes in number of spaces?
    moveElementals();

    //4. Draw Reinforcements (3 cards)
    drawReinforcements();
}

function revealRavage() {
    // 1. Reveal Ravage Cards
        // add "visible": "Player1" when implementing multiplayer
        // reveal top card of each Ravage stack (move from deck to [i][6])
        for (var i = 2; i <= 5; i++) {
            // console.log(game.player.Ravage.stacks[i-1]);
            gameBoard[i][6].pop(); // remove emptyCard
            gameBoard[i][6].push(ravageStacks[i-2].shift());
        }

        showBoard();

        // Add all effects to stack
        for (var i = 2; i <= 5; i++) {
            effectsZone.push(gameBoard[i][6][0]);
        }

}


function resolveRavage() {
    // Resolve effects based on priority
        // only priorities A, B, C, D
        // elementals have no effect
    for (var i = 0; i < 4; i++) {
        horizontalLine2();
        console.log("Resolving priority " + String.fromCharCode(65+i) + " cards");
        for (var j = 0; j < effectsZone.length; j++) {
            var currentCard = effectsZone[j]
            if (currentCard.priority == String.fromCharCode(65+i)) {
                playCard(currentCard);
                // console.log("j:", j);
                removeFromBoard(j+2,6);
            }
        }
    }
    effectsZone = []
}

function moveElementals() {
    // 2. Move Elementals
    // move elementals by 1 space
    horizontalLine();
    console.log("Move Elementals");
    ForExtendedBattlefield(resolve("move",1));
    //show board after moving
    showBoard();
}


function drawReinforcements() {
        horizontalLine();
        console.log("Get Reinforcements");
        draw(3,"Player1");
        showHand();

        // 4. Defense
        // require console input
        // console.log("Player1's Hand",cardNames(firstPlayer.hand));
        // playCardFromHand(card#)


        // moveElemental(copy?) card to stack
        // select cards to pay (mana pool - cost)
        // if cant pay, return card to same spot in hand
        // select targets if any
        // resolve effects

    // 5. Show Board
    // showBoard();

    return "*****"
}
newGame();
battle();



/*

TODO:

1.  functionality for other Sylvan cards:
       - Owl
       - Elephant
       - Whale
       - Hedgehogs?

2.  functionality for life total loss

3.  refactor



*/